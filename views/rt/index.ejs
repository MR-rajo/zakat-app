<%- include('../layouts/header', { title: 'Data RW & RT - Zakat Fitrah App',
bodyClass: 'bg-gray-50 min-h-screen', currentPage: 'rt' }) %>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">
        <i class="fas fa-building mr-2 text-primary-600"></i>Data RW & RT
      </h1>
      <p class="text-gray-600 mt-1">Kelola data Rukun Warga (RW) dan Rukun Tetangga (RT)</p>
    </div>
    <div class="flex gap-4 mx-5">
      <a href="/rw/create" class="btn-primary">
        <i class="fas fa-plus mr-2"></i>Tambah RW
      </a>
      <a href="/rt/create" class="btn-primary">
        <i class="fas fa-plus mr-2"></i>Tambah RT
      </a>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
    <div class="card text-center">
      <div class="text-3xl font-bold text-primary-600">
        <%= rwList.length %>
      </div>
      <div class="text-sm text-gray-600">Total RW</div>
    </div>
    <div class="card text-center">
      <div class="text-3xl font-bold text-green-600">
        <%= rwList.reduce((sum, rw) => sum + (rw.total_rt || 0), 0) %>
      </div>
      <div class="text-sm text-gray-600">Total RT</div>
    </div>
    <div class="card text-center">
      <div class="text-3xl font-bold text-blue-600">
        <%= rwList.reduce((sum, rw) => sum + (rw.total_muzakki || 0), 0) %>
      </div>
      <div class="text-sm text-gray-600">Total Muzakki</div>
    </div>
    <div class="card text-center">
      <div class="text-3xl font-bold text-yellow-600">
        Rp <%= Math.floor(rtList.reduce((sum, rt) => sum + (rt.total_zakat || 0), 0)).toLocaleString('id-ID') %>
      </div>
      <div class="text-sm text-gray-600">Total Zakat</div>
    </div>
  </div>

  <!-- Data RW Section -->
  <div class="card mb-8">
    <div class="flex justify-between items-center mb-6">
      <div>
        <h2 class="text-xl font-semibold text-gray-900">Data RW</h2>
        <p class="text-gray-600 mt-1">Kelola data Rukun Warga (RW)</p>
      </div>
      <a href="/rw/create" class="btn-primary">
        <i class="fas fa-plus mr-2"></i>Tambah RW
      </a>
    </div>

    <div class="table-responsive">
      <% if (rwList.length === 0) { %>
      <div class="text-center py-12">
        <i class="fas fa-building text-6xl text-gray-300 mb-4"></i>
        <h3 class="text-xl font-medium text-gray-900 mb-2">Belum ada data RW</h3>
        <p class="text-gray-600 mb-6">Mulai dengan menambahkan data RW pertama</p>
        <a href="/rw/create" class="btn-primary">
          <i class="fas fa-plus mr-2"></i>Tambah RW
        </a>
      </div>
      <% } else { %>
      <table class="table">
        <thead>
          <tr>
            <th>RW</th>
            <th>Ketua RW</th>
            <th>Keterangan</th>
            <th>Statistik</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody>
          <% rwList.forEach(function(rw) { %>
          <tr class="hover:bg-blue-50 transition-colors duration-150">
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center">
                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                  <i class="fas fa-building text-blue-600"></i>
                </div>
                <div class="ml-4">
                  <div class="text-sm font-semibold text-gray-900">
                    <%= rw.nomor_rw %>
                  </div>
                  <div class="text-sm text-gray-500">ID: <%= rw.id %></div>
                </div>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm font-semibold text-gray-900"><%= rw.ketua_rw %></div>
              <div class="text-sm text-gray-500">Ketua RW</div>
            </td>
            <td class="px-6 py-4">
              <div class="text-sm text-gray-900"><%= rw.keterangan || '-' %></div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm text-gray-900">
                <div class="flex items-center space-x-3">
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                    <i class="fas fa-home mr-1"></i><%= rw.total_rt || 0 %> RT
                  </span>
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                    <i class="fas fa-users mr-1"></i><%= rw.total_muzakki || 0 %> Muzakki
                  </span>
                </div>
              </div>
            </td>
            <td>
              <div class="flex gap-4">
                <a href="/rw/<%= rw.id %>/detail" class="text-blue-600 hover:text-blue-800 transition-colors duration-150" title="Detail RW">
                  <i class="fas fa-eye text-lg"></i>
                </a>
                <a href="/rw/<%= rw.id %>/edit" class="text-indigo-600 hover:text-indigo-800 transition-colors duration-150" title="Edit RW">
                  <i class="fas fa-edit text-lg"></i>
                </a>
                <form method="POST" action="/rw/<%= rw.id %>/delete" class="inline" id="delete-rw-form-<%= rw.id %>">
                  <button type="button" class="text-red-600 hover:text-red-800 transition-colors duration-150" title="Hapus RW" data-nomor="<%= rw.nomor_rw %>" data-id="<%= rw.id %>" onclick="confirmDeleteRW(this)">
                    <i class="fas fa-trash text-lg"></i>
                  </button>
                </form>
              </div>
            </td>
          </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
    <% } %>
  </div>

  <!-- RT Table -->
  <div class="card">
    <div class="flex justify-between items-center mb-6">
      <div>
        <h2 class="text-xl font-semibold text-gray-900">Daftar RT</h2>
        <p class="text-gray-600 mt-1">Kelola data Rukun Tetangga (RT)</p>
      </div>
      <a href="/rt/create" class="btn-primary">
        <i class="fas fa-plus mr-2"></i>Tambah RT
      </a>
    </div>

    <div class="table-responsive">
      <% if (rtList.length === 0) { %>
      <div class="text-center py-12">
        <i class="fas fa-home text-6xl text-gray-300 mb-4"></i>
        <h3 class="text-xl font-medium text-gray-900 mb-2">Belum ada data RT</h3>
        <p class="text-gray-600 mb-6">Mulai dengan menambahkan data RT pertama</p>
        <a href="/rt/create" class="btn-primary">
          <i class="fas fa-plus mr-2"></i>Tambah RT
        </a>
      </div>
      <% } else { %>
      <table class="table">
        <thead>
          <tr>
            <th>RW</th>
            <th>RT</th>
            <th>Ketua RT</th>
            <th>Keterangan</th>
            <th>Statistik</th>
            <th>Total Zakat</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody>
          <% rtList.forEach(function(rt) { %>
          <tr>
            <td>
              <div class="font-medium"><%= rt.nomor_rw || '-' %></div>
              <div class="text-xs text-gray-500">Ketua: <%= rt.ketua_rw || '-' %></div>
            </td>
            <td>
              <div class="font-medium text-gray-900"><%= rt.nomor_rt %></div>
              <div class="text-xs text-gray-500">ID: <%= rt.id %></div>
            </td>
            <td>
              <div class="font-medium text-gray-900"><%= rt.ketua_rt %></div>
              <div class="text-xs text-gray-500">Ketua RT</div>
            </td>
            <td>
              <div class="text-sm text-gray-900">
                <%= rt.keterangan || '-' %>
              </div>
            </td>
            <td>
              <div class="text-sm text-gray-900">
                <div class="flex items-center space-x-3">
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                    <i class="fas fa-users mr-1"></i><%= rt.total_muzakki %>
                    Muzakki
                  </span>
                </div>
                <div class="flex items-center space-x-2 mt-2">
                  <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                    <i class="fas fa-check mr-1"></i><%= rt.muzakki_lunas %>
                    Lunas
                  </span>
                  <% if (rt.muzakki_belum_lunas > 0) { %>
                  <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                    <i class="fas fa-times mr-1"></i><%= rt.muzakki_belum_lunas
                    %> Belum
                  </span>
                  <% } %>
                </div>
              </div>
            </td>
            <td>
              <div class="font-medium text-gray-900">
                Rp <%= Math.floor(rt.total_zakat).toLocaleString('id-ID') %>
              </div>
            </td>
            <td>
              <div class="flex gap-4">
                <a
                  href="/rt/<%= rt.id %>/detail"
                  class="text-blue-600 hover:text-blue-900"
                  title="Detail RT"
                >
                  <i class="fas fa-eye"></i>
                </a>
                <a
                  href="/rt/<%= rt.id %>/edit"
                  class="text-indigo-600 hover:text-indigo-900"
                  title="Edit RT"
                >
                  <i class="fas fa-edit"></i>
                </a>
                <form
                  method="POST"
                  action="/rt/<%= rt.id %>/delete"
                  class="inline"
                  id="delete-form-<%= rt.id %>"
                >
                  <button
                    type="button"
                    class="text-red-600 hover:text-red-900"
                    title="Hapus RT"
                    data-nomor="<%= rt.nomor_rt %>"
                    data-id="<%= rt.id %>"
                    onclick="confirmDeleteRT(this)"
                  >
                    <i class="fas fa-trash"></i>
                  </button>
                </form>
              </div>
            </td>
          </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
    <% } %>
  </div>
</div>

<%- include('../layouts/footer') %>

<script>
  function confirmDeleteRT(btn) {
    const nomor = btn.dataset.nomor;
    const id = btn.dataset.id;
    Swal.fire({
      title: 'Konfirmasi Hapus',
      text: `Yakin ingin menghapus RT ${nomor}? Data ini tidak dapat dikembalikan.`,
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#d33',
      cancelButtonColor: '#3085d6',
      confirmButtonText: 'Ya, Hapus',
      cancelButtonText: 'Batal'
    }).then((result) => {
      if (result.isConfirmed) {
        document.getElementById(`delete-form-${id}`).submit();
      }
    });
  }

  function confirmDeleteRW(btn) {
    const nomor = btn.dataset.nomor;
    const id = btn.dataset.id;
    Swal.fire({
      title: 'Konfirmasi Hapus',
      text: `Yakin ingin menghapus RW ${nomor}? Data ini tidak dapat dikembalikan.`,
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#d33',
      cancelButtonColor: '#3085d6',
      confirmButtonText: 'Ya, Hapus',
      cancelButtonText: 'Batal'
    }).then((result) => {
      if (result.isConfirmed) {
        document.getElementById(`delete-rw-form-${id}`).submit();
      }
    });
  }
</script>
