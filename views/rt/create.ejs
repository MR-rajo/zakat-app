<%- include('../layouts/header', { title: 'Tambah RT - Zakat Fitrah App',
bodyClass: 'bg-gray-50 min-h-screen', currentPage: 'rt' }) %>

<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
  <!-- Header -->
  <div class="mb-6">
    <div class="flex items-center mb-4">
      <a href="/rt" class="text-primary-600 hover:text-primary-800 mr-4">
        <i class="fas fa-arrow-left"></i>
      </a>
      <h1 class="text-3xl font-bold text-gray-900">
        <i class="fas fa-plus mr-2 text-primary-600"></i>Tambah RT
      </h1>
    </div>
    <p class="text-gray-600">Tambahkan data RT baru ke sistem</p>
  </div>

  <!-- Form -->
  <div class="bg-white shadow-sm rounded-lg overflow-hidden">
    <div class="px-6 py-4 border-b border-gray-200">
      <h2 class="text-lg font-semibold text-gray-900">Informasi RT</h2>
    </div>

    <form method="POST" action="/rt/create" class="p-6 space-y-6" id="rt-form">
      <!-- Pilih RW -->
      <div>
        <label
          for="rw_id"
          class="block text-sm font-medium text-gray-700 mb-2"
        >
          Pilih RW <span class="text-red-500">*</span>
        </label>
        <div class="relative">
          <div
            class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
          >
            <i class="fas fa-building text-gray-400"></i>
          </div>
          <select
            id="rw_id"
            name="rw_id"
            required
            class="appearance-none block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
          >
            <option value="">Pilih RW</option>
            <% rwList.forEach(function(rw) { %>
            <option value="<%= rw.id %>"><%= rw.nomor_rw %> - <%= rw.ketua_rw %></option>
            <% }); %>
          </select>
        </div>
        <p class="mt-1 text-sm text-gray-500">
          Pilih RW tempat RT ini berada
        </p>
      </div>

      <!-- Nomor RT -->
      <div>
        <label
          for="nomor_rt"
          class="block text-sm font-medium text-gray-700 mb-2"
        >
          Nomor RT <span class="text-red-500">*</span>
        </label>
        <div class="relative">
          <div
            class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
          >
            <i class="fas fa-home text-gray-400"></i>
          </div>
          <input
            type="text"
            id="nomor_rt"
            name="nomor_rt"
            required
            placeholder="Contoh: RT 01, RT 02, dll"
            class="appearance-none block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500"
          />
        </div>
        <p class="mt-1 text-sm text-gray-500">
          Masukkan nomor RT, contoh: RT 01, RT 02, RT 11, dll.
        </p>
      </div>

      <!-- Ketua RT -->
      <div>
        <label
          for="ketua_rt"
          class="block text-sm font-medium text-gray-700 mb-2"
        >
          Nama Ketua RT <span class="text-red-500">*</span>
        </label>
        <div class="relative">
          <div
            class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
          >
            <i class="fas fa-user text-gray-400"></i>
          </div>
          <input
            type="text"
            id="ketua_rt"
            name="ketua_rt"
            required
            placeholder="Nama lengkap ketua RT"
            class="appearance-none block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500"
          />
        </div>
        <p class="mt-1 text-sm text-gray-500">Masukkan nama lengkap ketua RT</p>
      </div>

      <!-- Keterangan -->
      <div>
        <label
          for="keterangan"
          class="block text-sm font-medium text-gray-700 mb-2"
        >
          Keterangan
        </label>
        <div class="relative">
          <div
            class="absolute top-3 left-0 pl-3 flex items-start pointer-events-none"
          >
            <i class="fas fa-sticky-note text-gray-400"></i>
          </div>
          <textarea
            id="keterangan"
            name="keterangan"
            rows="3"
            placeholder="Catatan tambahan atau keterangan RT (opsional)"
            class="appearance-none block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500"
          ></textarea>
        </div>
        <p class="mt-1 text-sm text-gray-500">
          Keterangan tambahan tentang RT (opsional)
        </p>
      </div>

      <!-- Action Buttons -->
      <div
        class="flex items-center justify-between pt-6 border-t border-gray-200"
      >
        <a href="/rt" class="btn-secondary">
          <i class="fas fa-times mr-2"></i>Batal
        </a>
        <button type="submit" class="btn-primary">
          <i class="fas fa-save mr-2"></i>Simpan RT
        </button>
      </div>
    </form>
  </div>

  <!-- Guidelines -->
  <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mt-6">
    <div class="flex">
      <div class="flex-shrink-0">
        <i class="fas fa-info-circle text-blue-400"></i>
      </div>
      <div class="ml-3">
        <h3 class="text-sm font-medium text-blue-800">Panduan Pengisian</h3>
        <div class="mt-2 text-sm text-blue-700">
          <ul class="list-disc space-y-1 ml-4">
            <li>Nomor RT harus unik dan belum terdaftar di sistem</li>
            <li>Format nomor RT: RT 01, RT 02, RT 11, dst</li>
            <li>Nama ketua RT akan digunakan untuk identifikasi</li>
            <li>Keterangan bersifat opsional dan dapat diisi nanti</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.getElementById("rt-form").addEventListener("submit", function (e) {
    e.preventDefault(); // Prevent default submit
    const nomorRt = document.getElementById("nomor_rt").value.trim();
    const ketuaRt = document.getElementById("ketua_rt").value.trim();

    if (!nomorRt || !ketuaRt) {
      Swal.fire({
        icon: 'error',
        title: 'Error',
        text: 'Nomor RT dan Nama Ketua RT harus diisi',
        confirmButtonText: 'OK'
      });
      return false;
    }

    Swal.fire({
      title: 'Konfirmasi Simpan',
      text: 'Apakah data RT yang dimasukkan sudah benar?',
      icon: 'question',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Ya, Simpan',
      cancelButtonText: 'Batal'
    }).then((result) => {
      if (result.isConfirmed) {
        this.submit();
      }
    });
  });

  // Format input nomor RT
  document.getElementById("nomor_rt").addEventListener("input", function (e) {
    let value = e.target.value.toUpperCase();

    // Auto format RT if user types just numbers
    if (/^\d+$/.test(value)) {
      const num = parseInt(value);
      if (num < 10) {
        value = `RT 0${num}`;
      } else {
        value = `RT ${num}`;
      }
      e.target.value = value;
    }
  });
</script>

<% if (error) { %>
<script>
  Swal.fire({
    icon: 'error',
    title: 'Error',
    text: '<%= error %>',
    confirmButtonText: 'OK'
  });
</script>
<% } %>

<% if (success) { %>
<script>
  Swal.fire({
    icon: 'success',
    title: 'Berhasil',
    text: '<%= success %>',
    confirmButtonText: 'OK'
  });
</script>
<% } %>

<%- include('../layouts/footer') %>
