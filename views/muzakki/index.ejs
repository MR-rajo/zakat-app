<%- include('../layouts/header', { title: 'Data Muzakki - Zakat Fitrah App',
bodyClass: 'bg-gray-50 min-h-screen', currentPage: 'muzakki' }) %>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">
        <i class="fas fa-users mr-2 text-primary-600"></i>Data Muzakki
      </h1>
      <p class="text-gray-600 mt-1">Kelola data muzakki dan zakat fitrah</p>
    </div>
    <a href="/muzakki/create" class="btn-primary">
      <i class="fas fa-plus mr-2"></i>Tambah Muzakki
    </a>
  </div>

  <!-- Statistics Cards -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
    <div class="card text-center">
      <div class="text-3xl font-bold text-primary-600">
        <%= muzakki.length %>
      </div>
      <div class="text-sm text-gray-600">Total Muzakki</div>
    </div>
    <div class="card text-center">
      <div class="text-3xl font-bold text-green-600">
        <%= muzakki.filter(m => m.jenis_zakat === 'beras').length %>
      </div>
      <div class="text-sm text-gray-600">Zakat Beras</div>
    </div>
    <div class="card text-center">
      <div class="text-3xl font-bold text-blue-600">
        <%= muzakki.filter(m => m.jenis_zakat === 'uang').length %>
      </div>
      <div class="text-sm text-gray-600">Zakat Uang</div>
    </div>
    <div class="card text-center">
      <div class="text-3xl font-bold text-yellow-600">
        Rp <%= Math.floor((muzakki || []).reduce((total, m) => total +
        (Number(m.kembalian) || 0), 0)).toLocaleString('id-ID') %>
      </div>
      <div class="text-sm text-gray-600">Total Kembalian</div>
    </div>
  </div>

  <!-- Data Table -->
  <div class="card">
    <div class="table-responsive">
      <% if (muzakki.length === 0) { %>
      <div class="text-center py-12">
        <i class="fas fa-users text-6xl text-gray-300 mb-4"></i>
        <h3 class="text-xl font-medium text-gray-900 mb-2">
          Belum ada data muzakki
        </h3>
        <p class="text-gray-600 mb-6">
          Mulai dengan menambahkan data muzakki pertama
        </p>
        <a href="/muzakki/create" class="btn-primary">
          <i class="fas fa-plus mr-2"></i>Tambah Muzakki
        </a>
      </div>
      <% } else { %>
      <table class="table">
        <thead>
          <tr>
            <th>RT</th>
            <th>Nama Muzakki</th>
            <th>Jumlah Jiwa</th>
            <th>Jenis Zakat</th>
            <th>Kewajiban</th>
            <th>Jumlah Bayar</th>
            <th>Kembalian</th>
            <th>Pencatat</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody>
          <% muzakki.forEach(function(item) { %>
          <tr>
            <td>
              <div class="font-medium"><%= item.nomor_rt || '-' %></div>
              <div class="text-xs text-gray-500">
                <%= item.ketua_rt || '-' %>
              </div>
            </td>
            <td>
              <div class="font-medium text-gray-900"><%= item.nama %></div>
              <% if (item.catatan) { %>
              <div class="text-xs text-gray-500"><%= item.catatan %></div>
              <% } %>
            </td>
            <td class="text-center">
              <span
                class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800"
              >
                <%= item.jumlah_jiwa %> jiwa
              </span>
            </td>
            <td>
              <% if (item.jenis_zakat === 'beras') { %>
              <span
                class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"
              >
                <i class="fas fa-seedling mr-1"></i>Beras
              </span>
              <% } else { %>
              <span
                class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"
              >
                <i class="fas fa-coins mr-1"></i>Uang
              </span>
              <% } %>
            </td>
            <td>
              <% if (item.jenis_zakat === 'beras') { %>
              <div class="font-medium"><%= item.jumlah_beras_kg %> kg</div>
              <% } else { %>
              <div class="font-medium">
                Rp <%= Math.floor(item.jumlah_uang).toLocaleString('id-ID') %>
              </div>
              <% } %>
            </td>
            <td>
              <div class="font-medium text-green-600">
                Rp <%= Math.floor(item.jumlah_bayar).toLocaleString('id-ID') %>
              </div>
            </td>
            <td>
              <% if (item.kembalian > 0) { %>
              <div class="font-medium text-yellow-600 mb-2">
                Rp <%= Math.floor(item.kembalian).toLocaleString('id-ID') %>
              </div>
              <form
                method="POST"
                action="/muzakki/<%= item.id %>/sedekahkan-kembalian"
                class="inline"
              >
                <button
                  type="submit"
                  class="text-green-600 hover:text-green-900 text-xs"
                  title="Sedekahkan Kembalian"
                  onclick="return confirm('Sedekahkan kembalian sebagai infak?')"
                >
                  <i class="fas fa-hand-holding-heart mr-1"></i>Sedekahkan
                </button>
              </form>
              <% } else { %>
              <div class="text-gray-400">-</div>
              <% } %>
            </td>
            <td>
              <div class="text-sm text-gray-600">
                <%= item.pencatat_name || '-' %>
              </div>
              <div class="text-xs text-gray-400">
                <%= new Date(item.created_at).toLocaleDateString('id-ID') %>
              </div>
            </td>
            <td>
              <div class="flex gap-4">
                <a
                  href="/muzakki/<%= item.id %>"
                  class="text-green-600 hover:text-green-900"
                  title="Detail"
                >
                  <i class="fas fa-eye"></i>
                </a>
                <a
                  href="/muzakki/<%= item.id %>/edit"
                  class="text-blue-600 hover:text-blue-900"
                  title="Edit"
                >
                  <i class="fas fa-edit"></i>
                </a>

                <form
                  method="POST"
                  action="/muzakki/<%= item.id %>?_method=DELETE"
                  class="inline"
                >
                  <button
                    type="submit"
                    class="text-red-600 hover:text-red-900"
                    title="Hapus"
                    onclick="return confirm('Yakin ingin menghapus data <%= item.nama %>?')"
                  >
                    <i class="fas fa-trash"></i>
                  </button>
                </form>
              </div>
            </td>
          </tr>
          <% }); %>
        </tbody>
      </table>
      <% } %>
    </div>
  </div>
</div>

<%- include('../layouts/footer') %>
