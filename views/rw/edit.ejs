<%- include('../layouts/header', { title: 'Edit RW - Zakat Fitrah App',
bodyClass: 'bg-gray-50 min-h-screen', currentPage: 'rt' }) %>

<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
  <!-- Header -->
  <div class="mb-6">
    <div class="flex items-center mb-4">
      <a href="/rw" class="text-primary-600 hover:text-primary-800 mr-4">
        <i class="fas fa-arrow-left"></i>
      </a>
      <h1 class="text-3xl font-bold text-gray-900">
        <i class="fas fa-edit mr-2 text-primary-600"></i>Edit RW
      </h1>
    </div>
    <p class="text-gray-600">Edit data RW <%= rw.nomor_rw %></p>
  </div>

  <!-- Form -->
  <div class="bg-white shadow-sm rounded-lg overflow-hidden">
    <div class="px-6 py-4 border-b border-gray-200">
      <h2 class="text-lg font-semibold text-gray-900">Informasi RW</h2>
    </div>

    <form
      method="POST"
      action="/rw/<%= rw.id %>/edit"
      class="p-6 space-y-6"
      id="rw-form"
    >
      <!-- Nomor RW -->
      <div>
        <label
          for="nomor_rw"
          class="block text-sm font-medium text-gray-700 mb-2"
        >
          Nomor RW <span class="text-red-500">*</span>
        </label>
        <div class="relative">
          <div
            class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
          >
            <i class="fas fa-building text-gray-400"></i>
          </div>
          <input
            type="text"
            id="nomor_rw"
            name="nomor_rw"
            required
            value="<%= rw.nomor_rw %>"
            placeholder="Contoh: RW 01, RW 02, dll"
            class="appearance-none block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500"
          />
        </div>
        <p class="mt-1 text-sm text-gray-500">
          Masukkan nomor RW, contoh: RW 01, RW 02, RW 11, dll.
        </p>
      </div>

      <!-- Ketua RW -->
      <div>
        <label
          for="ketua_rw"
          class="block text-sm font-medium text-gray-700 mb-2"
        >
          Nama Ketua RW <span class="text-red-500">*</span>
        </label>
        <div class="relative">
          <div
            class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
          >
            <i class="fas fa-user text-gray-400"></i>
          </div>
          <input
            type="text"
            id="ketua_rw"
            name="ketua_rw"
            required
            value="<%= rw.ketua_rw %>"
            placeholder="Nama lengkap ketua RW"
            class="appearance-none block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500"
          />
        </div>
        <p class="mt-1 text-sm text-gray-500">Masukkan nama lengkap ketua RW</p>
      </div>

      <!-- Keterangan -->
      <div>
        <label
          for="keterangan"
          class="block text-sm font-medium text-gray-700 mb-2"
        >
          Keterangan
        </label>
        <div class="relative">
          <div
            class="absolute top-3 left-0 pl-3 flex items-start pointer-events-none"
          >
            <i class="fas fa-sticky-note text-gray-400"></i>
          </div>
          <textarea
            id="keterangan"
            name="keterangan"
            rows="3"
            placeholder="Catatan tambahan atau keterangan RW (opsional)"
            class="appearance-none block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500"
          >
<%= rw.keterangan || '' %></textarea
          >
        </div>
        <p class="mt-1 text-sm text-gray-500">
          Keterangan tambahan tentang RW (opsional)
        </p>
      </div>

      <!-- Action Buttons -->
      <div
        class="flex items-center justify-between pt-6 border-t border-gray-200"
      >
        <a href="/rw" class="btn-secondary">
          <i class="fas fa-times mr-2"></i>Batal
        </a>
        <button type="submit" class="btn-primary">
          <i class="fas fa-save mr-2"></i>Simpan Perubahan
        </button>
      </div>
    </form>
  </div>

  <!-- Information -->
  <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mt-6">
    <div class="flex">
      <div class="flex-shrink-0">
        <i class="fas fa-exclamation-triangle text-yellow-400"></i>
      </div>
      <div class="ml-3">
        <h3 class="text-sm font-medium text-yellow-800">Informasi Penting</h3>
        <div class="mt-2 text-sm text-yellow-700">
          <ul class="list-disc space-y-1 ml-4">
            <li>
              Perubahan nomor RW akan mempengaruhi semua data RT di RW ini
            </li>
            <li>Pastikan nomor RW yang baru tidak bentrok dengan RW lain</li>
            <li>Data yang sudah disimpan tidak dapat dikembalikan</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.getElementById("rw-form").addEventListener("submit", function (e) {
    e.preventDefault(); // Prevent default submit
    const nomorRw = document.getElementById("nomor_rw").value.trim();
    const ketuaRw = document.getElementById("ketua_rw").value.trim();

    if (!nomorRw || !ketuaRw) {
      Swal.fire({
        icon: 'error',
        title: 'Error',
        text: 'Nomor RW dan Nama Ketua RW harus diisi',
        confirmButtonText: 'OK'
      });
      return false;
    }

    Swal.fire({
      title: 'Konfirmasi Simpan',
      text: 'Apakah perubahan data RW sudah benar?',
      icon: 'question',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Ya, Simpan',
      cancelButtonText: 'Batal'
    }).then((result) => {
      if (result.isConfirmed) {
        this.submit();
      }
    });
  });

  // Format input nomor RW
  document.getElementById("nomor_rw").addEventListener("input", function (e) {
    let value = e.target.value.toUpperCase();

    // Auto format RW if user types just numbers
    if (/^\d+$/.test(value)) {
      const num = parseInt(value);
      if (num < 10) {
        value = `RW 0${num}`;
      } else {
        value = `RW ${num}`;
      }
      e.target.value = value;
    }
  });
</script>

<% if (error) { %>
<script>
  Swal.fire({
    icon: 'error',
    title: 'Error',
    text: '<%= error %>',
    confirmButtonText: 'OK'
  });
</script>
<% } %>

<% if (success) { %>
<script>
  Swal.fire({
    icon: 'success',
    title: 'Berhasil',
    text: '<%= success %>',
    confirmButtonText: 'OK'
  });
</script>
<% } %>

<%- include('../layouts/footer') %>